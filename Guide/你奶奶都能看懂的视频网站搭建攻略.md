### 写在前面

> 说是教程，其实是自己在佛系搭建电影网时的一点经验总结记录在册，方便后续回顾，如果能恰好帮到你，非常荣幸😆。
>
> 原视频网域名申请于2017年，是由群主 `@查尔辰` 自行搭建的群晖影库并无偿分享给群友，因为前一阵子联通营业厅的一系列官方操作，终于误伤了影库的IP，导致原影库基本永久性不可公开使用。借此契机，与查老师协商搭建全新影视网站，贡献社会。本攻略由我与查老师共同操作完成。



----

# Let's get started~ ;)

# 0 大纲

#### 大体步骤抽离出来其实只有5步，网上很多其他教程也基本都围绕着这5步，但是其中涉及的细节配置却省略很多，这个也能理解，毕竟猫教老虎——留一手🙃，后面会围绕以下5步逐一介绍，也包括遇到的问题，和自己的一些小总结

- 买服务器和域名
- 装服务器控制台
- 装服务器环境
- 装电影网后台
- 配置电影网资源

#### 耐心看完，你一定会有所收获（芒果冰发言



----

# 1 购买服务器

#### CYUN (https://www.cyun.net/) 上面购买的服务器可以直接安装宝塔（什么是宝塔解释在下面），该服务器base香港，可以避免备案问题，省时间，购买后可在页面直接看到IP地址和对应版本，以及服务器日志

#### 选服务器时，操作系统我们协商后选的centOS，也就是linux系统，这应该也是大部分人的第一选择

<img src="/Guide/img/1.png" alt="1" style="zoom:50%;" />

> **名词解释：**
>
> **服务器** 万物之爹，是基础，后面的一切都是在有了服务器搭载以后才可以进行，但不要误会，这里的服务器只是用来访问域名和管理，不做任何影视资源的存储，因此不需要顾虑容量不够的问题。除了上述的CYUN外，国内还有诸如阿里云，华为云等有较大优惠政策的服务器，摸摸钱包酌情选择。
>
> **宝塔** 一个简单好用的Linux服务器运维管理面板，后续用来容纳数据库、FTP及相关的网站资源等等，最重要的是它可以帮你安装如Nginx、mySql等环境配置，非常美妙。
>
> **备案** 你也不想以后出了事有人找吧，你也不想搭个网站卡半个多月的审核吧？
>
> 
>
> **一点吐槽：**
>
> 本步最大卡点主要在于你愿意花多少钱买个多好的服务器...



## 1.1 安装宝塔

#### 在上述步骤中我因为懒且想逃避备案所以选了cyun，如果有小可爱选了比如阿里云的话，需要自己手动在你的服务器上安装宝塔，用了cyun的大聪明们也要继续看，不要直接跳过

#### Windows使用Xshell (需自行下载)可以直接连接服务器，而Mac使用自带的Terminal，需要输入以下命令开启ssh就可以连接服务器了

```
ssh -p 22 你的服务器名@服务器ip地址            // Mac专用，服务器名通常是root，买的时候看一下
```

#### 如果使用了其他服务器的话，接下来使用yum方式安装宝塔，中间似乎需要输个 `y` 还是 `yes` 来继续安装

```
yum install -y wget && wget -O install.sh http://download.bt.cn/install/install.sh && sh install.sh
```

#### 直接一个cv上去，啪的一下很快啊安装就成功了，这时候你会看到终端上显示了好多行英文，告诉你域名 (Bt-Panel-URL) 和宝塔的账号密码 (usename & password)

#### cyun的话直接在浏览器打开`服务器ip:8888` （端口号默认应该是8888）就可以看到下面选中的部分，复制到开启了ssh并连接了服务器的终端，也能看到终端显示了宝塔的域名，和账密信息

<img src="/Guide/img/2.png" alt="2" style="zoom:50%;" />

<img src="/Guide/img/3.png" alt="3" style="zoom:67%;" />



> **名词解释：**
>
> **ssh** Secure Shell，顾名思义，只是个壳，用来为远程登录会话和其他网络服务，也就是通讯，提供安全性协议，不提供连接实现的功能
>
> **Xshell** Xshell 是一个强大的安全终端模拟软件，它支持SSH1, SSH2，Mac可以直接用自带的terminal一样实现。



----

# 2 购买域名

#### 在登陆宝塔之前或者之后，没有域名是没法顺利在宝塔的控制台里好好玩耍的，所以现在要去买个域名，也就是你网站的网址

#### 这里以阿里云为例，跟着他的指导一步步创建并购买一个自己喜欢的域名就可以了

<img src="/Guide/img/4.png" alt="1" style="zoom:50%;" />

#### 有了域名以后，在自己的控制台主页里，选择「域名」，然后提示登录

<img src="/Guide/img/5.png" alt="1" style="zoom:50%;" />

#### 登录后点击这个「全部域名」下面的数字，代表你的域名数量

<img src="/Guide/img/6.png" alt="1" style="zoom:50%;" />

#### 找到刚才买的域名，点击后面的「解析」，进去后「修改」，然后把之前买的服务器的ip地址复制进去，点击「确认」，解析完成~

#### 好了，这会你的域名和ip已经登记结婚了，以后就是捆绑出现了😃

<img src="/Guide/img/7.png" alt="1" style="zoom:50%;" />

<img src="/Guide/img/8.png" alt="1" style="zoom:50%;" />

<img src="/Guide/img/9.png" alt="1" style="zoom:50%;" />



> **名词解释：**
>
> **域名** 也就是通常看到的网址，他跟ip地址是一一对应的，需要解析后DNS才能知道他们是一对，在你输入网址后DNS才能帮你找到ip对应的那个服务器。
>
> 
>
> **一点吐槽：**
>
> 这一步和第1步一样，可能你会纠结在怎么搞到一个响亮的域名然后发现好TMD贵...



----

# 3 登陆宝塔

#### 终于要开始有意思的实操步骤了么。

#### 用第1步中拿到的宝塔账密登录，进入以下界面，可以在左边看到我们需要操作的菜单和首页下显示的已经安装的软件 (需要自己手动设置是否显示在首页)

<img src="/Guide/img/10.png" alt="1" style="zoom:50%;" />



## 3.1 安装软件 (环境)

#### 搭建影视网站需要3个基本的软件 (或者说是环境) 支持：Nginx、PHP、mySql，在软件商店内输入关键字搜索安装即可，安装后最好显示在首页并确认安装成功，<font color='#FC6240'>否则后面步骤出了错误都没意识到是环境没装好，别问我怎么知道的</font>

#### mySql和Nginx只有对应的一个版本，安装时不会有顾虑，PHP版本较多，我在这选择了 `7.3` 版本，截止至 2022.6.27 最新版本为 `8.1` ，但这里有一个比较让人费解的问题，放在下面「吐槽」里解释，建议先去看一眼再跟着正常步骤走，不然PHP容易白装🫠

<img src="/Guide/img/11.png" alt="1" style="zoom:50%;" />



## 3.2 创建网站

#### 点击左边「网站」，创建站点，输入域名，选择数据库 `MySql` ，选择php版本为当前安装版本

<img src="/Guide/img/13.jpeg" alt="1" style="zoom:50%;" />

#### 创建完网站后找到域名复制，在Safari内粘贴就能看到以下画面了，那么恭喜你，你的网站创建成功了！~

#### 这里不使用chrome的原因是chrome会自动将网址中的协议补齐为更安全的https，但我们是基于http的所以，换个浏览器继续吧

<img src="/Guide/img/14.png" alt="1" style="zoom:50%;" />

<img src="/Guide/img/15.png" alt="1" style="zoom:50%;" />



## 3.3 配置Maccms安装包

#### 不知道什么是Maccms的老铁 <s>建议退出本教程</s> 建议先去看看下面的名词解释

#### 先将文件中默认的index.html等文件删除，这时候刷新站点变成403了不要怕，后面会直接变成安装窗口的

<img src="/Guide/img/16.png" alt="1" style="zoom:50%;" />

#### 接着从maccms国内[官网](https://www.maccms.cn/down.html)上下载比较适合的版本，我用的10，下载到本地后解压

#### 这里有一个技巧操作需要注意：解压后得到了一个文件夹，文件夹内的文件们如下图，<font color='#FC6240'>将这些单独打包成zip!!</font>，方便后续上传后的解压操作可以直接将这些文件们解压到根目录而不是一个单独的目录中。 总之最后就是，让这些文件放在根目录，而不是将一个文件夹放到根目录（好像说了句废话

#### 因为我最开始把单独一个目录解压进去导致识别不到安装程序🥲

<img src="/Guide/img/17.png" alt="1" style="zoom:50%;" />

<img src="/Guide/img/19.png" alt="1" style="zoom:50%;" />

#### 上传后解压到根目录，根目录长下面这样了

<img src="/Guide/img/20.png" alt="1" style="zoom:50%;" />

<img src="/Guide/img/21.png" alt="1" style="zoom:50%;" />

#### ‼️然后，重点来了，点开上图1所示，本地的文件列表中的「说明文档-伪静态规则-maccms.conf」，将配置文件中的代码复制，粘贴到下图伪静态配置里并保存

<img src="/Guide/img/18.png" alt="1" style="zoom:50%;" />

#### 刷新Safari，你将看到⬇️ 好的，这一阶段大功告成！奖励自己休息一周（bushi

<img src="/Guide/img/22.png" alt="1" style="zoom:50%;" />



> **名词解释：**
>
> **Maccms** 苹果提供的一个内容管理系统，是电影网的基础，可以提供很多现成的模板和功能，类似的还有很多比如飞飞、海洋、PHP等等cms。这里选择苹果有以下几个原因：1、更新相对及时，更稳定安全；2、模板丰富一些，网站应该可以更好看；3、采集插件比较丰富，包括采集资源和播放视频的插件，很贴心
>
> 
>
> **一些吐槽：**
>
> 1.宝塔第一次打开、软件商店页面打开以及搜索过程都可能会比较慢，正常现象，稍安勿躁
>
> 2.当我使用 `php 8.1` 版本创建的服务器，maccms解压安装后，在浏览器中打开  `http://你的域名/install.php` 或者 `http://你的域名` 会直接将install文件下载下来，这显然是不正确的，正常情况下应该是看到maccsm的安装提示，我在排除不是其他误操作问题后发现，可能是7.3版本在创建数据库时会选择对应的php版本，而最新的8.1版本只有默认的纯静态选项，导致数据库创建出了问题，所以如果你也遇到了同样的问题，先去看看是不是php版本导致的
>
<img src="/Guide/img/12.png" alt="1" style="zoom:50%;" />



----

# 4 正式安装Maccms

#### 点击「同意协议并安装系统」后，发现少了个插件，这时候回到宝塔，进入软件商店，找到对应的php版本，点击后选择「安装扩展」，将缺失的 `fileinfo` 安装，然后点击上面的「服务」，切记「重启」！！！！

<img src="/Guide/img/23.png" alt="1" style="zoom:50%;" />

<img src="/Guide/img/24.png" alt="24" style="zoom:50%;" />

#### 安装后刷新下一步，进入到数据库配置页，将数据库的账密信息填好，并在下面创建maccms的管理员账号密码

<img src="/Guide/img/25.png" alt="25" style="zoom:50%;" />

#### 执行安装后会看到CMS的敷衍式欢迎⬇️

<img src="/Guide/img/26.png" alt="26" style="zoom:50%;"/>

#### 然后用刚才的管理员账密登录后，就能进到CMS管理后台——「超级控制台」了，到这一步，Maccms正式安装完毕，接下来就可以在内部配置电影网模板、资源以及插件了，可能有小可爱现在就去刷新网页试了试，不好意思，你还没有电影网的模板，看不到东西的，莫慌，接着看



> **一些提示：**
>
> 全程几乎没什么操作难点，记得不要把maccms的管理员账号密码给忘了就行hhh



----

# 5 配置电影资源网的一切

#### 这一步总共需要配置

- 1.电影网站的模板，也就是它长什么样子；

- 2.采集资源的插件，好让你的网站有东西看；

- 3.资源的分类，这一点务必记得配置，没有分类的资源是拉取不到的 (<font color='red'>未分类资源，err</font>)，当然如果你着急看到网站是否搭建成功，可以先简单选择个别分类，不然采集过程非常耗时
- 4.播放视频的插件



## 5.1 配置网站模板

#### 回到宝塔控制台，找到文件下面maccms解压位置的「template(模板)」，点开后可以看到默认的两个模板，这时候就可以上传你在网上找到的比较好看的模板资源了，这里需要注意导入的模板资源分为pc和移动端两类，且务必提前看一下人家default的两个文件内的格式是`css`  `html` `js` 等等的基本网页文件配置，你不要傻了吧唧的把模板包直接一个解压进去层层套着，这样点开你的域名会提示找不到 `index.html` 的

<img src="/Guide/img/27.png" alt="27" style="zoom:50%;" />

#### 好了，上传好以后，回到maccms的控制台，选择「系统」下的「网站参数配置」，将网站域名和手机站域名分别更新为你的域名，然后划到下面将网站模板和手机模板选择为你喜欢的那两个，每次更新模板都需要在这重新更改配置，点击保存，模板就配置成功啦，现在去打开网页就能看到——好家伙模板一片空白！但是起码有个轮廓了~

<img src="/Guide/img/29.png" alt="29" style="zoom:50%;" />

<img src="/Guide/img/28.png" alt="28" style="zoom:50%;" />



## 5.2 采集资源插件

#### 选择上面导航栏的「采集」-「自定义接口」-「添加」，看到以下界面，这里我提供几个资源采集网，时效性问题不一定全部能用，后三个似乎健全一些

- 酷云资源站：http://www.kuyunzy1.com/
- OK资源站：http://api.iokzy.com/
- 209资源站：http://www.1156zy.net/
- 豆瓣资源站：http://douban666.com/
- 步步高资源站：http://www.bbkdj.com/help
- 天空资源站：http://help.tiankongapi.com/#wlcome

<img src="/Guide/img/30.png" alt="30" style="zoom:50%;" />

#### 以天空资源站为例，点进去以后，在上面能看到你安装的对应的cms的采集api窗口，选择苹果cms10，将下方连接粘贴至上面的「接口地址」，资源名称可以当成是备注，下面的接口类型选择 `xml` ，资源类型选择 `视频` ，数据操作选择 `新增+更新` ，点击测试、保存即可

<img src="/Guide/img/31.png" alt="31" style="zoom:50%;" />

#### 现在点开下面的链接，就能看到分类，这里最好将分类应有尽有，不然会拉不下来资源。做好分类后可以手动在下面将全选的资源采集

<img src="/Guide/img/33.png" alt="33" style="zoom:50%;" />



## 5.3 视频播放插件

#### 醒醒孩子，没装播放器呢，现在点进去看不了视频的！

#### 点击「视频」-「播放器」-「导入」，将提前准备好的播放插件放进去，双击上传就好，没有的话我把我用的放到git仓库下的 `maccms10-video` 文件夹内了，拿的到的话可以用，不过有这时间从网上也找到了hhh

<img src="/Guide/img/34.png" alt="34" style="zoom:50%;" />



## 5.4 临门一脚

#### 好了，现在等你的采集插件将资源拉取下来后，刷新网页再看看，是不是能看到一个还挺有内回事的网站了！

#### 恭喜你，所有的步骤都浅趟一遍了，为什么说是浅趟，因为如果想要让这个网站更健壮，还需要额外配置很多细节的东西，我放在最后一part说。Anyways，到了这里，你已经可以 <s>截图发票圈装b了😎</s> 开心的找找有没有你想看的资源了😌~

<img src="/Guide/img/35.png" alt="35" style="zoom:50%;" />



> **名词解释：**
>
> **资源采集网** 通俗讲就是它来帮你从网上搜刮资源并将资源投到你的网站上，直接决定你的影院资源的质量，包括但不限于资源种类的多少、资源的清晰度、以及资源过一阵子会不会挂掉
>
> 
>
> **一些经验：**
>
> 影院的后期维护集中在宝塔系统和Maccms中，前者维护服务器，后者维护影院。影院的配置细节非常繁琐，不是能一两天玩明白的，所以需要相当长的耐心，当然你也可以找一找志同道合的小伙伴和你一起。



----

# 6 可优化项

#### 上述流程走完以后，只是简单的搭建了一个可行的网站，但如果你想让这个网站体验更好，让更多朋友可以访问，还需要进一步完善。可能你在搭建过程中就遇到了一些可以优化的内容或者尚未解决的问题，我在这里列举一些我能想到的问题及解决方法，以供参考



## 1.因为HTTP协议而导致以Chrome为首的浏览器打不开网站

#### 上面提到，chrome会默认将不安全的http协议补全为https，这会直接导致我们访问不到现在的服务器，因此需要将http添加证书升级为https，解决方法有2个，一个傻瓜式，一个费力不讨好式

## 1.1 傻瓜式

#### 都已经用宝塔系统了，直接让宝塔安装证书不香么，网站点进来「SSL」去下载Let's Encrypt证书，选中你的域名，然后申请，等就完四了~

#### 然后...就没了，对，就这么无脑...... 现在就可以在chrome等浏览器内用https访问网站了

<img src="/Guide/img/41.png" alt="1" style="zoom:50%;" />



## 1.2 费力不讨好式（笔者未走通，慎选）

#### [Git教程](https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E)，git提供了使用终端下载证书的方法，是从ZeroSSL下载的证书，分享一下我的探索过程

#### 输入⬇️，使用curl安装

```
curl  https://get.acme.sh | sh -s email=my@example.com    // 后面邮箱不用改
```

#### 然后安装证书，他提供的命令是⬇️，然后将域名替换成你的域名，然后回车

```
acme.sh  --issue  -d mydomain.com -d www.mydomain.com  --webroot  /home/wwwroot/mydomain.com/
```

#### 发现......

<img src="/Guide/img/37.png" alt="37" style="zoom:50%;" />

#### 一直超时，怎么肥四呢，又去网上搜索了下Timeout的原因和思路，有人将解决方法贴了出来

<img src="/Guide/img/38.png" alt="38" style="zoom:50%;" />

#### 红框内为问题原因，我们先看b，大家都能访问所以肯定是公网没问题，回去看cyun的配置——emmmm没有设置任何防火墙阻拦，更不可能是http服务没有运行的问题，所以不是b。

<img src="/Guide/img/39.png" alt="1" style="zoom:50%;" />

#### 回头看a，指定路径有误，原来是 `/home/wwwroot/mydomain.com/` 这句路径出了问题，回头看我们宝塔内域名的路径是 `/www/wwwroot/我的域名`，所以将路径更改后即可成功继续安装

<img src="/Guide/img/40.png" alt="40" style="zoom:50%;" />

#### 好，卡点来了，现在证书需要安装到服务器根目录下的nginx文件夹内，但提示路径不存在，我去翻了文件，在确定服务器上已经安装了nginx以后还是没有找到「nginx」文件夹，推测是被隐藏了，因此这个方法到此就搁置了😞。



## 2.因为分类不全导致采集资源失败

#### 资源采集前的分类选项不够会导致采集时频繁红字，maccms提供的分类已经很多，但选项很少，比如你想选「纪录片」，但提供绑定的选项里没有纪录片，因此需要额外添加选项，来适配maccms提供的资源分类，这里提供在maccms系统里设置的方法

<img src="/Guide/img/36.png" alt="36" style="zoom:50%;" />

#### 进到「基础」-「分类管理」-「添加」，填写自定义分类后「保存」，然后把状态设置为「开启」

<img src="/Guide/img/43.png" alt="43" style="zoom:50%;" />

#### 这时候再回去看，已经有纪录片分类了

<img src="/Guide/img/44.png" alt="44" style="zoom: 50%;" />

#### 还是在分类管理中，找到父级「电影」分类，「编辑」，拉到下面，在「扩展分类」添加 "纪录片"，这样网站上才会多出这个选项以供选择，用这个方法将采集的分类全部绑定后，资源才能最大化且最准确

<img src="/Guide/img/45.png" alt="1" style="zoom:50%;" />



## 3.采集的资源质量不高，清晰度不够

#### 这个问题相信你在看视频时已经发现了，综艺、电影、电视剧等等都可能不是让你满意的清晰度，甚至没法调节。

#### 这是资源采集插件的问题，它连接的资源网的质量不够，自己没有试过但是或许可以绑定多个采集插件，但维护起来可能更麻烦，量力而行。或者网上有诸如 "火车头" 这样的自动化采集工具，有兴趣可以自己去研究，在此不做过多解释 (其实是因为查老师去配置我懒了)



## 4.关于界面过于丑陋

#### 你可能因为不舍得花钱，而也从网上找一些比较泛泛又毫无审美的模板，这个我也木得办法，目前作者本人也在被这个事情恶心，群晖的私有云界面无论用哪个姿势体验都比这些模板好看一万倍，现在有一种突然掉价的感觉。

#### 后面会研究下一些看起来更高级的自适应电影网模板，如果可行，可能会花钱update。但极大概率存在不匹配问题（因为不知道下下来的高级模板文件夹内都有哪些内容），因此这里也不推荐先去花钱买



## 5.资源不对以及自动采集

#### 待查老师补充，我累了



----

### 写在后面

> 一点小小的个人感慨吧：非常幸运，因为一款大二入坑的漫威游戏，加了这个虽然全是陌生人但是天天吹水一直到现在有6年之久的闲聊群，虽然大家职业、年龄、价值观都完全不同，但也不乏偶尔在群里看到中外各地有意思的新闻，发一些有意思的图片。所以在上一个影库为大家服务这么久光荣下岗之后，才会想让这个东西继续顶上来，我不知道他能坚持多久，也不需要知道，因为一手资源永远有人在群里第一时间更新，根本不需要有这么一个平台去更新，他存在的价值更像是提醒我们每天那一句两句的『查老师，影库又炸了』。